import{r as S,l as $t,j as i}from"./index-Cf2K4EOO.js";import"./react-OvXVS5lI.js";class Y{constructor(t=2,n=[16],l={}){this._WEIGHT_CLAMP=1e3,this.inputSize=t,this.hidden=Array.isArray(n)?n:[n],this.lr=l.lr||.3,this.optimizer=l.optimizer||"sgd",this.activation=l.activation||"sigmoid",this.momentumCoef=l.momentum??.9,this.beta1=l.beta1??.9,this.beta2=l.beta2??.999,this.eps=l.eps??1e-8,this.iter=0,this.velocityW=null,this.velocityB=null,this.mW=null,this.vW=null,this.mB=null,this.vB=null,this.initWeights()}initWeights(){this.weights=[],this.biases=[];let t=this.inputSize;for(let u=0;u<this.hidden.length;u++){const s=this.hidden[u],R=Math.sqrt(2/(t+s)),g=()=>{let B=0,k=0;for(;B===0;)B=Math.random();for(;k===0;)k=Math.random();return Math.sqrt(-2*Math.log(B))*Math.cos(2*Math.PI*k)};this.weights.push(Array.from({length:s},()=>Array.from({length:t},()=>g()*R))),this.biases.push(Array.from({length:s},()=>0)),t=s}const b=Math.sqrt(2/(t+1)),m=()=>{let u=0,s=0;for(;u===0;)u=Math.random();for(;s===0;)s=Math.random();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*s)};this.weights.push(Array.from({length:1},()=>Array.from({length:t},()=>m()*b))),this.biases.push([0]),this.initOptimizerState()}initOptimizerState(){this.velocityW=this.weights.map(t=>t.map(n=>n.map(()=>0))),this.velocityB=this.biases.map(t=>t.map(()=>0)),this.mW=this.weights.map(t=>t.map(n=>n.map(()=>0))),this.vW=this.weights.map(t=>t.map(n=>n.map(()=>0))),this.mB=this.biases.map(t=>t.map(()=>0)),this.vB=this.biases.map(t=>t.map(()=>0)),this.iter=0}static sigmoid(t){return 1/(1+Math.exp(-t))}static sigmoidDeriv(t){return t*(1-t)}static tanh(t){return Math.tanh(t)}static tanhDeriv(t){return 1-t*t}static relu(t){return Math.max(0,t)}static reluDeriv(t){return t>0?1:0}static leakyRelu(t){return t>0?t:.01*t}static leakyReluDeriv(t){return t>0?1:.01}activate(t){switch(this.activation){case"tanh":return Y.tanh(t);case"relu":return Y.relu(t);case"leaky_relu":return Y.leakyRelu(t);default:return Y.sigmoid(t)}}activateDeriv(t,n){switch(this.activation){case"tanh":return Y.tanhDeriv(t);case"relu":return Y.reluDeriv(n??t);case"leaky_relu":return Y.leakyReluDeriv(n??t);default:return Y.sigmoidDeriv(t)}}forward(t){let n=t.slice();for(let b=0;b<this.weights.length;b++){const m=this.weights[b],u=this.biases[b],s=new Array(m.length).fill(0);for(let A=0;A<m.length;A++){let N=u[A]||0;const R=m[A];for(let g=0;g<R.length;g++)N+=R[g]*n[g];s[A]=N}b<this.weights.length-1?n=s.map(A=>this.activate(A)):n=s.map(A=>Y.sigmoid(A))}const l=n[0];if(!Number.isFinite(l)||Number.isNaN(l)){try{console.error("MLPClassifier.forward produced non-finite output",l)}catch{}return .5}return l}predict(t){return this.forward(t)>=.5?1:0}trainSample(t,n,l=null){const b=l??this.lr;this.optimizer==="adam"&&(this.iter+=1);const m=[t.slice()];let u=t.slice();const s=[];for(let g=0;g<this.weights.length;g++){const B=this.weights[g],k=this.biases[g],f=new Array(B.length).fill(0);for(let x=0;x<B.length;x++){let M=k[x]||0;const W=B[x];for(let J=0;J<W.length;J++)M+=W[J]*u[J];f[x]=M}s.push(f),g<this.weights.length-1?u=f.map(x=>this.activate(x)):u=f.map(x=>Y.sigmoid(x)),m.push(u)}const A=m[m.length-1][0];if(!Number.isFinite(A)||Number.isNaN(A)){try{console.error("MLPClassifier.trainSample: non-finite prediction, aborting sample update",A)}catch{}return}let R=[n-A];for(let g=this.weights.length-1;g>=0;g--){const B=m[g];for(let k=0;k<this.weights[g].length;k++){const f=R[k];for(let x=0;x<this.weights[g][k].length;x++){let M=f*B[x];const W=5;M>W?M=W:M<-W&&(M=-W),this.applyWeightUpdate(g,k,x,M,b)}this.applyBiasUpdate(g,k,f,b)}if(g>0){const k=new Array(this.weights[g-1].length).fill(0);for(let f=0;f<this.weights[g].length;f++){const x=this.weights[g][f];for(let M=0;M<x.length;M++)k[M]+=x[M]*R[f]}R=k.map((f,x)=>{const M=s[g-1][x];return f*this.activateDeriv(m[g][x],M)})}}}applyWeightUpdate(t,n,l,b,m){if(this.optimizer==="momentum"){this.velocityW||this.initOptimizerState();const u=this.velocityW[t][n][l]=this.momentumCoef*this.velocityW[t][n][l]-m*b;this.weights[t][n][l]+=u}else if(this.optimizer==="adam"){(!this.mW||!this.vW)&&this.initOptimizerState();const u=this.mW[t][n][l]=this.beta1*this.mW[t][n][l]+(1-this.beta1)*b,s=this.vW[t][n][l]=this.beta2*this.vW[t][n][l]+(1-this.beta2)*b*b,A=u/(1-Math.pow(this.beta1,this.iter)),N=s/(1-Math.pow(this.beta2,this.iter));this.weights[t][n][l]+=m*(A/(Math.sqrt(N)+this.eps))}else this.weights[t][n][l]+=m*b;try{let u=this.weights[t][n][l];(!Number.isFinite(u)||Number.isNaN(u))&&(u=0),u>this._WEIGHT_CLAMP&&(u=this._WEIGHT_CLAMP),u<-this._WEIGHT_CLAMP&&(u=-this._WEIGHT_CLAMP),this.weights[t][n][l]=u}catch(u){try{typeof console<"u"&&console&&console.debug&&console.debug("mlp: weight clamp error",u)}catch{}}}applyBiasUpdate(t,n,l,b){if(this.optimizer==="momentum"){this.velocityB||this.initOptimizerState();const m=this.velocityB[t][n]=this.momentumCoef*this.velocityB[t][n]-b*l;this.biases[t][n]+=m}else if(this.optimizer==="adam"){(!this.mB||!this.vB)&&this.initOptimizerState();const m=this.mB[t][n]=this.beta1*this.mB[t][n]+(1-this.beta1)*l,u=this.vB[t][n]=this.beta2*this.vB[t][n]+(1-this.beta2)*l*l,s=m/(1-Math.pow(this.beta1,this.iter)),A=u/(1-Math.pow(this.beta2,this.iter));this.biases[t][n]+=b*(s/(Math.sqrt(A)+this.eps))}else this.biases[t][n]+=b*l;try{let m=this.biases[t][n];(!Number.isFinite(m)||Number.isNaN(m))&&(m=0),m>this._WEIGHT_CLAMP&&(m=this._WEIGHT_CLAMP),m<-this._WEIGHT_CLAMP&&(m=-this._WEIGHT_CLAMP),this.biases[t][n]=m}catch(m){try{typeof console<"u"&&console&&console.debug&&console.debug("mlp: bias clamp error",m)}catch{}}}fit(t,n,l={}){const b=l.epochs||40,m=l.lr||this.lr,u=l.batchSize||8,s=l.shuffle!==void 0?l.shuffle:!0,A=l.onEpoch,N=[],R=t.length,g=Array.from({length:R},(B,k)=>k);for(let B=0;B<b;B++){if(s)for(let f=R-1;f>0;f--){const x=Math.floor(Math.random()*(f+1)),M=g[f];g[f]=g[x],g[x]=M}for(let f=0;f<R;f+=u){const x=Math.min(f+u,R);for(let M=f;M<x;M++){const W=t[g[M]],J=n[g[M]];this.trainSample(W,J,m)}}const k=this.loss(t,n);if(N.push(k),typeof A=="function")try{A(B,k)}catch(f){typeof console<"u"&&console&&console.debug&&console.debug("mlp: onEpoch callback error",f)}}return N}accuracy(t,n){if(!Array.isArray(t)||!Array.isArray(n)||t.length!==n.length)return NaN;let l=0;for(let b=0;b<t.length;b++)this.predict(t[b])===(n[b]?1:0)&&l++;return l/t.length}loss(t,n){if(!Array.isArray(t)||!Array.isArray(n)||t.length!==n.length)return NaN;let l=0;for(let b=0;b<t.length;b++){const m=Math.min(.999999,Math.max(1e-6,this.forward(t[b]))),u=n[b]?1:0;l-=u*Math.log(m)+(1-u)*Math.log(1-m)}return l/t.length}reset(t=null){t&&(this.hidden=Array.isArray(t)?t:[t]),this.iter=0,this.initWeights()}setActivation(t){this.activation=t,this.initWeights()}}const te=({showInstructions:Tt=!0,speedScale:t=1,dataset:n,onDatasetChange:l,resetToken:b,compact:m=!1})=>{const u=S.useRef(null),s=S.useRef(null),[A,N]=S.useState(!0),[R,g]=S.useState(null),[B,k]=S.useState(null),f=S.useRef(null),[x,M]=S.useState(null),[W,J]=S.useState(null),[Vt,St]=S.useState(null),[ht,ut]=S.useState("sgd"),[dt,wt]=S.useState("sigmoid"),[pt,ft]=S.useState(.3),[mt,zt]=S.useState(8),[gt,Mt]=S.useState(100),[bt,At]=S.useState(32),[Wt,Gt]=S.useState(!1),[Ct,Nt]=S.useState(4),[yt,Pt]=S.useState("A"),Dt=S.useRef(null),d=S.useRef(null),[Jt,Kt]=S.useState(null),[Qt,Ft]=S.useState(140),$=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,It=$?"rgba(45,55,72,0.95)":"rgba(255,255,255,0.95)",P=$?"#f7fafc":"#1a202c",D=$?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)",Q=$?"#2d3748":"#ffffff",Z=P,kt=$?"0 8px 32px rgba(0,0,0,0.6)":"0 8px 32px rgba(0,0,0,0.08)",a=()=>{try{const o=globalThis.process;return!!(o&&o.env&&o.env.NODE_ENV!=="production")}catch{return!1}};S.useEffect(()=>{const o=e=>{const V=e;let H=[],w=[],G=[],E=null,U=null,tt=!1,et=0,xt=.3,st=0,nt=null,it=null,ot=4,O=ot,Ut=18,T=!0,X=null,ct=0,lt=0;const _t=.15;let Bt=0;e.suppressStatus=p=>{try{Bt=Date.now()+Math.max(0,Number(p)||0)}catch(r){a()&&console.debug("mlp: prevPreds reset error",r)}};const vt=(p=[])=>{const r=d.current,h=r?.lr??.3,y=r?.optimizer??"sgd",_=r?.activation??"sigmoid",C=r?.hiddenUnits??16,v=p.length?p:[C,Math.max(8,Math.floor(C/2))];E=new Y(2,v,{lr:h,optimizer:y,activation:_});try{X=null,ct=0,lt=0}catch(j){a()&&console.debug("mlp: prevPreds reset error",j)}},Lt=()=>{H=[],w=[],G=[];for(let p=0;p<50;p++){const r=e.random(-1,1),h=e.random(-1,1),y=r*.4+.1>h?"A":"B";H.push({x:r,y:h,label:y}),w.push([r,h]),G.push(y==="A"?1:0)}vt(),T=!0},Rt=()=>{const p=Math.max(1,Math.min(e.width||600,e.height||600));ot=Math.max(3,Math.floor(p/150))};e.setup=()=>{u.current&&u.current.querySelectorAll("canvas").forEach(r=>r.remove());const p=u.current?.getBoundingClientRect();e.createCanvas(Math.max(300,p?.width||600),Math.max(300,p?.height||600)),e.frameRate?.(45),typeof e.pixelDensity=="function"&&e.pixelDensity(1),U=e.createGraphics?e.createGraphics(e.width,e.height):null,Rt(),O=it??ot,Lt(),n&&Array.isArray(n)&&n.length&&e.updateDataset(n);try{const r=u.current;if(r){const h=r.querySelector("canvas");if(h){const y=v=>{const j=h.getBoundingClientRect(),F=v.clientX-j.left,K=v.clientY-j.top;if(F<0||K<0||F>e.width||K>e.height)return;const I=e.map(F,0,e.width,-1,1),q=e.map(K,0,e.height,1,-1);let L="A";try{v.pointerType==="touch"?L=e._mlpControls?.touchClass??"A":L=v.button===2?"B":"A"}catch(rt){a()&&console.debug("mlp: touch detection error",rt),L=v.button===2?"B":"A"}H.push({x:I,y:q,label:L}),w.push([I,q]),G.push(L==="A"?1:0),T=!0,l&&l((rt=[])=>[...rt,{x:I,y:q,label:L}])},_=v=>v.preventDefault();h.addEventListener("pointerdown",y),h.addEventListener("contextmenu",_);const C=h;C._mlpPointerHandler=y,C._mlpContextHandler=_}}}catch(r){a()&&console.debug("mlp: canvas setup error",r)}try{V._setGridStep=r=>{it=Math.max(2,r),O=it,T=!0;try{X=null,ct=0,lt=0}catch(h){a()&&console.debug("mlp: prevPreds reset error",h)}},e._mlpControls={get optimizer(){return d.current?.optimizer??"sgd"},set optimizer(r){try{d.current?d.current.optimizer=r:d.current={optimizer:r,activation:"sigmoid",lr:.3,batchSize:8,epochs:100,hiddenUnits:16,touchClass:"A",setGridStep:d.current?.setGridStep??(()=>{})},T=!0}catch(h){a()&&console.debug("mlp: control init error",h)}},get activation(){return d.current?.activation??"sigmoid"},set activation(r){try{d.current?d.current.activation=r:d.current={optimizer:"sgd",activation:r,lr:.3,batchSize:8,epochs:100,hiddenUnits:16,touchClass:"A",setGridStep:d.current?.setGridStep??(()=>{})},T=!0}catch(h){a()&&console.debug("mlp: fullFit finalAccuracy error",h)}},get lr(){return d.current?.lr??.3},set lr(r){try{d.current?d.current.lr=r:d.current={optimizer:"sgd",activation:"sigmoid",lr:r,batchSize:8,epochs:100,hiddenUnits:16,touchClass:"A",setGridStep:d.current?.setGridStep??(()=>{})}}catch(h){a()&&console.debug("mlp: lr setter error",h)}},get batchSize(){return d.current?.batchSize??8},set batchSize(r){try{d.current?d.current.batchSize=r:d.current={optimizer:"sgd",activation:"sigmoid",lr:.3,batchSize:r,epochs:100,hiddenUnits:16,touchClass:"A",setGridStep:d.current?.setGridStep??(()=>{})}}catch(h){a()&&console.debug("mlp: batchSize setter error",h)}},get epochs(){return d.current?.epochs??100},set epochs(r){try{d.current?d.current.epochs=r:d.current={optimizer:"sgd",activation:"sigmoid",lr:.3,batchSize:8,epochs:r,hiddenUnits:16,touchClass:"A",setGridStep:d.current?.setGridStep??(()=>{})}}catch(h){a()&&console.debug("mlp: epochs setter error",h)}},get hiddenUnits(){return d.current?.hiddenUnits??16},set hiddenUnits(r){try{d.current?d.current.hiddenUnits=r:d.current={optimizer:"sgd",activation:"sigmoid",lr:.3,batchSize:8,epochs:100,hiddenUnits:r,touchClass:"A",setGridStep:d.current?.setGridStep??(()=>{})},T=!0}catch(h){a()&&console.debug("mlp: hiddenUnits setter error",h)}},get touchClass(){return d.current?.touchClass??"A"},set touchClass(r){try{d.current?d.current.touchClass=r:d.current={optimizer:"sgd",activation:"sigmoid",lr:.3,batchSize:8,epochs:100,hiddenUnits:16,touchClass:r,setGridStep:d.current?.setGridStep??(()=>{})}}catch(h){a()&&console.debug("mlp: touchClass setter error",h)}},setGridStep:r=>{try{V._setGridStep?.(r)}catch(h){a()&&console.debug("mlp: setGridStep error",h)}}}}catch(r){a()&&console.debug("mlp: control setup error",r)}},V.windowResized=()=>{const p=u.current?.getBoundingClientRect();e.resizeCanvas?.(Math.max(300,p?.width||600),Math.max(300,p?.height||600)),U=e.createGraphics?e.createGraphics(e.width,e.height):null,Rt(),O=it??ot,T=!0},e.draw=()=>{try{if(typeof document<"u"&&document.hidden)return}catch(r){a()&&console.debug("mlp: visibility probe error",r)}if(tt&&E&&w.length&&et>0){const r=Math.max(3,Math.min(10,Math.floor(5*(e.speedScale||1))));for(let h=0;h<r;h++){const y=Math.floor(Math.random()*w.length);if(E.trainSample(w[y],G[y],xt),st++,st>=w.length){st=0,et--;try{const _=E.loss(w,G);e._lastLoss=_}catch(_){a()&&console.debug("mlp: model.loss error",_)}if(T=!0,et<=0){tt=!1;let _=0;try{E&&typeof E.accuracy=="function"&&(_=E.accuracy(w,G))}catch(v){a()&&console.debug("mlp: accuracy calc error",v)}let C=null;try{const v=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();nt!=null&&(C=(v-nt)/1e3)}catch(v){a()&&console.debug("mlp: time measurement error",v)}try{window.dispatchEvent(new CustomEvent("mlv:demo-finished",{detail:{classifier:"Neural Network (MLP)",reason:"train-complete",accuracy:_,elapsedSec:C}}))}catch(v){a()&&console.debug("mlp: event dispatch error",v)}try{if(f.current){const v=e._lastLoss,j=C!=null?` â€¢ Time: ${C.toFixed(2)}s`:"",F=typeof v=="number"?`Training finished â€” Loss: ${v.toFixed(4)}${j}`:`Training finished${j}`;f.current.innerText=F,f.current.style.display="block"}}catch(v){a()&&console.debug("mlp: DOM update error",v)}}}}}const p=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;e.background(p?42:240);try{let r={classifier:"mlp",equation:null,weights:void 0,bias:void 0,updatedAt:Date.now()};if(Date.now()<Bt)r.suppressed=!0;else if(E&&w.length)try{let h=0,y=0;for(let v=0;v<w.length;v++){const j=E.forward(w[v]);h+=j,(j>=.5?1:0)===G[v]&&y++}const _=h/w.length,C=y/w.length;r.meanPred=_,r.accuracy=C,r.samples=w.length}catch(h){a()&&console.debug("mlp: runtime status error",h)}window.mlvStatus=r}catch(r){a()&&console.debug("mlp: status publish error",r)}if(U||(U=e.createGraphics?e.createGraphics(e.width,e.height):null),O=it??ot,e.frameCount%Ut===0||T){T=!1,U.clear();const r=p?"rgba(50,110,210,0.38)":"rgba(120,170,230,0.55)",h=p?"rgba(235,70,70,0.38)":"rgba(230,120,120,0.55)";U.noStroke();const y=Math.ceil(e.width/O),_=Math.ceil(e.height/O);if(!X||ct!==y||lt!==_){X=new Float32Array(y*_),ct=y,lt=_;for(let C=0;C<X.length;C++)X[C]=.5}for(let C=0,v=0;C<e.width;C+=O,v++)for(let j=0,F=0;j<e.height;j+=O,F++){const K=e.map(C+.5*O,0,e.width,-1,1),I=e.map(j+.5*O,e.height,0,-1,1);let q=.5;try{if(E){const Et=E.forward([K,I]);q=Number.isFinite(Et)?Et:.5}}catch{q=.5}const L=v+F*y,at=(X[L]??.5)*(1-_t)+q*_t;X[L]=at;const Ot=at>=.5;U.fill(Ot?h:r);const qt=Math.min(O,e.width-C),Yt=Math.min(O,e.height-j);U.rect(C,j,qt,Yt)}}e.image(U,0,0);for(const r of H){const h=e.map(r.x,-1,1,0,e.width),y=e.map(r.y,-1,1,e.height,0);e.fill(r.label==="A"?"#e53e3e":"#4299e1"),e.noStroke(),e.circle(h,y,12)}},e.mousePressed=()=>{if(!s.current||e.mouseX<0||e.mouseY<0||e.mouseX>e.width||e.mouseY>e.height)return;const p=e.map(e.mouseX,0,e.width,-1,1),r=e.map(e.mouseY,e.height,0,-1,1);let h="A";try{e.touches&&e.touches.length>0?h=e._mlpControls?.touchClass??"A":h=e.mouseButton===e.LEFT?"A":"B"}catch{h=e.mouseButton===e.LEFT?"A":"B"}H.push({x:p,y:r,label:h}),w.push([p,r]),G.push(h==="A"?1:0),T=!0,l&&l((y=[])=>[...y,{x:p,y:r,label:h}])},e.updateDataset=p=>{if(H=[],w=[],G=[],p&&Array.isArray(p))for(const r of p)H.push({x:r.x,y:r.y,label:r.label}),w.push([r.x,r.y]),G.push(r.label==="A"?1:0);vt(),T=!0},e.trainMLP=(p={})=>{try{f.current&&(f.current.style.display="none")}catch(y){a()&&console.debug("mlp: finishedRef hide error",y)}if(E||vt(),!E||!w.length)return;const r=Number(p.epochs??NaN),h=Math.max(10,Math.floor(30/Math.max(1,t)));et=Number.isFinite(r)&&r>0?Math.max(1,Math.floor(r)):h,xt=p.lr??.3,st=0,tt=!0;try{typeof e.loop=="function"&&e.loop()}catch(y){a()&&console.debug("mlp: p.loop error",y)}if(a())try{console.debug("mlp: trainMLP called",{epochs:et,lr:xt,samples:w.length})}catch(y){console.debug("mlp: trainMLP debug log failed",y)}try{nt=performance&&performance.now?performance.now():Date.now()}catch(y){a()&&console.debug("mlp: performance.now probe error",y),nt=Date.now()}try{St(null)}catch(y){a()&&console.debug("mlp: setLastDurationSec error",y)}T=!0},e.fullFit=(p={})=>{if(!E||!w.length)return;const r=tt;tt=!1;let h=Date.now();const y=p.epochs??Math.max(100,d.current?.epochs??200),_=p.lr??d.current?.lr??.3,C=p.batchSize??w.length,v=Math.max(1,p.maxAttempts??3);try{let j=0,F;for(let I=1;I<=v;I++){const q=E.fit(w,G,{epochs:y,lr:_,batchSize:C,shuffle:!1,onEpoch:(L,rt)=>{try{e._lastLoss=rt,L%10===0&&(T=!0)}catch(at){a()&&console.debug("mlp: onEpoch hook error",at)}}});try{F=Array.isArray(q)&&q.length?q[q.length-1]:F}catch(L){a()&&console.debug("mlp: fullFit lastLoss calc error",L)}try{j=E.accuracy(w,G)}catch(L){a()&&console.debug("mlp: fullFit accuracy calc error",L)}if(j>=1)break;if(a())try{console.debug("mlp: fullFit attempt",I,{lastLoss:F,finalAccuracy:j})}catch(L){a()&&console.debug("mlp: fullFit attempt log failed",L)}}const K=(Date.now()-h)/1e3;try{window.dispatchEvent(new CustomEvent("mlv:demo-finished",{detail:{classifier:"Neural Network (MLP)",reason:"train-complete",accuracy:j,elapsedSec:K}}))}catch(I){a()&&console.debug("mlp: prevPreds reset error",I)}try{f.current&&(f.current.innerText=typeof e._lastLoss=="number"?`Training finished â€” Loss: ${e._lastLoss.toFixed(4)} â€¢ Time: ${K.toFixed(2)}s`:`Training finished â€¢ Time: ${K.toFixed(2)}s`,f.current.style.display="block")}catch(I){a()&&console.debug("mlp: control init error",I)}T=!0}catch(j){a()&&console.debug("mlp: fullFit error",j)}finally{tt=r}},e.resetDemo=()=>{try{U&&typeof U.clear=="function"&&U.clear()}catch(p){a()&&console.debug("mlp: grid clear error",p)}try{e._lastLoss=void 0}catch(p){a()&&console.debug("mlp: lastLoss reset error",p)}tt=!1,et=0,T=!0,Lt(),l&&l([]);try{f.current&&(f.current.style.display="none")}catch(p){a()&&console.debug("mlp: finishedRef hide error",p)}try{St(null)}catch(p){a()&&console.debug("mlp: setLastDurationSec error",p)}}};let c=!0;const z=u.current;return N(!0),(async()=>{try{const e=await $t();if(!c)return;const V=e&&e.default||e;s.current&&(s.current.remove(),s.current=null);const H=z,w=V;s.current=new w(o,H),N(!1),g(null)}catch(e){a()&&console.debug("mlp: dynamic import p5 failed",e),g(typeof e=="string"?e:String(e)),N(!1)}})(),()=>{c=!1;const e=z;if(e){const V=e.querySelector("canvas");if(V){const H=V,w=H._mlpPointerHandler,G=H._mlpContextHandler;w&&V.removeEventListener("pointerdown",w),G&&V.removeEventListener("contextmenu",G)}}s.current&&(s.current.remove(),s.current=null)}},[n,l,t]),S.useEffect(()=>{const o=d.current?.setGridStep??(c=>{});d.current={optimizer:ht,activation:dt,lr:pt,batchSize:mt,epochs:gt,hiddenUnits:bt,touchClass:yt,setGridStep:o}},[ht,dt,pt,mt,gt,bt,yt,Ct]),S.useEffect(()=>{const o=()=>{try{const c=s.current;if(!c||typeof c.noLoop!="function"||typeof c.loop!="function")return;document.hidden?c.noLoop():c.loop()}catch(c){a()&&console.debug("mlp: visibility handler error",c)}};return document.addEventListener("visibilitychange",o),o(),()=>document.removeEventListener("visibilitychange",o)},[]),S.useEffect(()=>{s.current&&typeof s.current.updateDataset=="function"&&s.current.updateDataset(n||[])},[n]),S.useEffect(()=>{const o=setInterval(()=>{if(s.current){const c=s.current._lastLoss;typeof c=="number"&&k(c);try{s.current?._mlpStatus}catch(z){a()&&console.debug("mlp: dynamic import p5 failed",z)}}},200);return()=>clearInterval(o)},[]),S.useEffect(()=>{if(!a())return;const o=setInterval(()=>{try{const c=window.mlvStatus;c&&(typeof c.meanPred=="number"&&M(c.meanPred),typeof c.accuracy=="number"&&J(c.accuracy))}catch(c){a()&&console.debug("mlp: window.mlvStatus poll error",c)}},300);return()=>clearInterval(o)},[]);const jt=S.useRef(!1);S.useEffect(()=>{a()&&(jt.current||x==null||W==null||(x<.05||x>.95)&&W<.7&&(jt.current=!0,ut("sgd"),ft(.3),setTimeout(()=>{const o=s.current;try{o&&typeof o.resetDemo=="function"&&(o.resetDemo(),typeof o.trainMLP=="function"&&o.trainMLP({epochs:50}))}catch(c){a()&&console.debug("mlp: auto-fallback error",c)}},200)))},[x,W]),S.useEffect(()=>{Ft(140)},[]),S.useEffect(()=>{const o=s.current;if(o&&typeof o.trainMLP=="function"){const c=setTimeout(()=>{const z=d.current?.epochs??100;o.trainMLP({epochs:Math.max(8,Math.floor(Number(z)/Math.max(1,t)))})},50);return()=>clearTimeout(c)}},[b,t]);const Ht=m?{position:"relative",width:"100%",height:"100%",overflow:"hidden",marginLeft:0}:{position:"relative",width:"calc(100% - 280px)",height:"100%",overflow:"hidden",marginLeft:"-200px"};return i.jsxs("div",{ref:u,style:Ht,children:[A&&i.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.6)",zIndex:2e3},children:i.jsx("div",{style:{padding:12,borderRadius:8,background:"rgba(0,0,0,0.6)",color:"#fff",fontWeight:600},children:"Loading demoâ€¦"})}),R&&i.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.45)",zIndex:2100,color:"#fff",padding:20},children:[i.jsxs("div",{style:{maxWidth:680,background:"rgba(0,0,0,0.6)",padding:18,borderRadius:8,boxShadow:"0 8px 32px rgba(0,0,0,0.6)"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Demo failed to load"}),i.jsx("div",{style:{marginBottom:12},children:String(R)}),i.jsx("div",{style:{fontSize:13,opacity:.9},children:"Try refreshing the page or check the browser console for details."})]}),a()&&i.jsxs("div",{style:{position:"absolute",right:280,top:12,zIndex:60,padding:"8px 10px",background:"rgba(0,0,0,0.6)",color:"#fff",borderRadius:8,fontSize:12,pointerEvents:"none"},children:[i.jsx("div",{style:{opacity:.9},children:"MLP debug"}),i.jsxs("div",{style:{fontFamily:"monospace",fontSize:12},children:["MeanPred: ",x==null?"â€”":x.toFixed(3)]}),i.jsxs("div",{style:{fontFamily:"monospace",fontSize:12},children:["Acc: ",W==null?"â€”":(W*100).toFixed(1)+"%"]})]})]}),i.jsxs("div",{style:{position:"absolute",left:12,top:12,zIndex:20,display:"flex",gap:8},children:[i.jsx("button",{onClick:()=>{k(null);try{J(null),M(null);try{window.mlvStatus=void 0}catch(o){a()&&console.debug("mlp: clear mlvStatus error",o)}}catch(o){a()&&console.debug("mlp: reset diagnostics error",o)}if(s.current&&typeof s.current.resetDemo=="function"){try{const o=s.current;o&&typeof o.suppressStatus=="function"&&o.suppressStatus(400)}catch(o){a()&&console.debug("mlp: suppressStatus error",o)}s.current.resetDemo()}},style:{padding:"8px 16px",fontSize:12,fontWeight:600,background:$?"rgba(45,55,72,0.95)":"rgba(255,255,255,0.95)",color:P,border:D,borderRadius:8,cursor:"pointer",backdropFilter:"blur(10px)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",transition:"all 0.2s ease"},onMouseOver:o=>{o.currentTarget.style.transform="translateY(-1px)",o.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)"},onMouseOut:o=>{o.currentTarget.style.transform="translateY(0)",o.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)"},children:"ðŸ”„ Reset"}),i.jsx("button",{onClick:()=>{try{const o=d.current?.epochs??200,c=s.current;c&&typeof c.fullFit=="function"&&c.fullFit({epochs:Math.max(50,Number(o)),lr:d.current?.lr,batchSize:d.current?.batchSize??void 0})}catch(o){try{a()&&console.debug("mlp: full-fit click error",o)}catch(c){a()&&console.debug("mlp: full-fit click debug error",c)}}},style:{padding:"8px 16px",fontSize:12,fontWeight:600,background:$?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.95)",color:$?"#fff":"#1a202c",border:D,borderRadius:8,cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.12)",transition:"all 0.15s ease"},children:"âš¡ Full-fit"}),i.jsx("button",{onClick:()=>{const o=d.current?.epochs??100;s.current&&typeof s.current.trainMLP=="function"&&s.current.trainMLP({epochs:Number(o)})},style:{padding:"8px 16px",fontSize:12,fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",boxShadow:"0 2px 8px rgba(102, 126, 234, 0.4)",transition:"all 0.2s ease"},onMouseOver:o=>{o.currentTarget.style.transform="translateY(-1px)",o.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.5)"},onMouseOut:o=>{o.currentTarget.style.transform="translateY(0)",o.currentTarget.style.boxShadow="0 2px 8px rgba(102, 126, 234, 0.4)"},children:"â–¶ï¸ Train"})]}),Tt&&i.jsx("div",{style:{position:"absolute",left:12,top:60,zIndex:20,maxWidth:280,background:$?"rgba(45,55,72,0.95)":"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",borderRadius:10,padding:"10px 12px",border:D,boxShadow:kt},children:i.jsxs("div",{style:{fontSize:12,color:P,lineHeight:1.5},children:[i.jsx("div",{style:{fontWeight:600,marginBottom:4,fontSize:11,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"ðŸ§  Neural Network"}),i.jsxs("div",{style:{fontSize:11,opacity:.9},children:[i.jsx("span",{style:{fontWeight:600},children:"Left click:"})," Add Red (A)",i.jsx("br",{}),i.jsx("span",{style:{fontWeight:600},children:"Right click:"})," Add Blue (B)"]})]})}),i.jsx("div",{ref:Dt,style:{position:"fixed",right:16,top:86,zIndex:1150,touchAction:"none",cursor:"default",maxHeight:"calc(100vh - 180px)",overflowY:"auto",display:m?"none":void 0},children:i.jsxs("div",{style:{padding:"12px",background:It,borderRadius:"12px",width:240,boxSizing:"border-box",color:P,border:D,boxShadow:kt},children:[i.jsx("div",{style:{marginBottom:10,paddingBottom:8,borderBottom:`1px solid ${$?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,fontSize:13,fontWeight:600,letterSpacing:"0.3px"},children:"âš™ï¸ Model Controls"}),i.jsxs("div",{style:{marginBottom:10,display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{id:"legacyStable",type:"checkbox",checked:Wt,onChange:o=>{const c=o.target.checked;if(Gt(c),c){ut("sgd"),ft(.3),At(16),wt("sigmoid"),Mt(20),zt(8);const z=s.current;try{z&&typeof z.resetDemo=="function"&&z.resetDemo()}catch(e){a()&&console.debug("mlp: legacy toggle reset error",e)}}}}),i.jsx("label",{htmlFor:"legacyStable",style:{fontSize:12,opacity:.9},children:"Legacy / Stable MLP (safe defaults)"})]}),i.jsxs("div",{style:{marginBottom:12},children:[i.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:6,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Architecture"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Activation"}),i.jsxs("select",{value:dt,onChange:o=>{if(wt(o.target.value),s.current){const c=s.current;c._mlpControls&&(c._mlpControls.activation=o.target.value),typeof c.resetDemo=="function"&&c.resetDemo()}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D},children:[i.jsx("option",{value:"sigmoid",children:"Sigmoid"}),i.jsx("option",{value:"tanh",children:"Tanh"}),i.jsx("option",{value:"relu",children:"ReLU"}),i.jsx("option",{value:"leaky_relu",children:"Leaky ReLU"})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Hidden Units"}),i.jsx("input",{type:"number",value:bt,onChange:o=>{const c=Number(o.target.value);if(At(c),s.current){const z=s.current;z._mlpControls&&(z._mlpControls.hiddenUnits=c)}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D,boxSizing:"border-box"}})]})]})]}),i.jsxs("div",{style:{marginBottom:12},children:[i.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:6,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Training"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:6},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Optimizer"}),i.jsxs("select",{value:ht,onChange:o=>{if(ut(o.target.value),s.current){const c=s.current;c._mlpControls&&(c._mlpControls.optimizer=o.target.value)}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D},children:[i.jsx("option",{value:"sgd",children:"SGD"}),i.jsx("option",{value:"momentum",children:"Momentum"}),i.jsx("option",{value:"adam",children:"Adam"})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Learning Rate"}),i.jsx("input",{type:"number",step:"0.01",value:pt,onChange:o=>{const c=Number(o.target.value);if(ft(c),s.current){const z=s.current;z._mlpControls&&(z._mlpControls.lr=c)}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D,boxSizing:"border-box"}})]})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Batch Size"}),i.jsx("input",{type:"number",value:mt,onChange:o=>{const c=Number(o.target.value);if(zt(c),s.current){const z=s.current;z._mlpControls&&(z._mlpControls.batchSize=c)}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D,boxSizing:"border-box"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Epochs"}),i.jsx("input",{type:"number",value:gt,onChange:o=>{const c=Number(o.target.value);if(Mt(c),s.current){const z=s.current;z._mlpControls&&(z._mlpControls.epochs=c)}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D,boxSizing:"border-box"}})]})]})]}),i.jsxs("div",{style:{marginBottom:8},children:[i.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:6,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Visualization"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Grid Size"}),i.jsx("input",{type:"number",value:Ct,onChange:o=>{const c=Number(o.target.value);Nt(c),s.current&&s.current._mlpControls?.setGridStep?.(c)},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D,boxSizing:"border-box"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:11,color:P,opacity:.8,display:"block",marginBottom:2},children:"Touch Adds"}),i.jsxs("select",{value:yt,onChange:o=>{const c=o.target.value;if(Pt(c),s.current){const z=s.current;z._mlpControls&&(z._mlpControls.touchClass=c)}},style:{width:"100%",padding:"4px 6px",fontSize:11,background:Q,color:Z,borderRadius:6,border:D},children:[i.jsx("option",{value:"A",children:"ðŸ”´ Red"}),i.jsx("option",{value:"B",children:"ðŸ”µ Blue"})]})]})]})]})]})}),i.jsxs("div",{style:{position:"absolute",left:12,bottom:12,zIndex:30,padding:"8px 12px",background:$?"rgba(45,55,72,0.95)":"rgba(255,255,255,0.95)",color:P,borderRadius:8,fontSize:11,fontWeight:500,border:D,backdropFilter:"blur(10px)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[i.jsx("span",{style:{opacity:.7},children:"Loss:"})," ",i.jsx("span",{style:{fontWeight:600,fontFamily:"monospace"},children:B==null?"â€”":B.toFixed(4)})]}),i.jsx("div",{ref:f,style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.6)",color:"#fff",padding:"8px 12px",borderRadius:8,fontSize:12,letterSpacing:.2,display:"none",zIndex:35,boxShadow:"0 4px 12px rgba(0,0,0,0.25)"},children:"Training finished"})]})};export{te as default};
