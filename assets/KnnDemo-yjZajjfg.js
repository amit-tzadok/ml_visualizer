import{r as x,l as q,j as o}from"./index-Cf2K4EOO.js";import"./react-OvXVS5lI.js";function P(f,S,R){if(!f||f.length===0)return null;const p=f.map(b=>({dist:Math.hypot(b.coords[0]-R[0],b.coords[1]-R[1]),label:b.label}));p.sort((b,d)=>b.dist-d.dist);const h=p.slice(0,Math.max(1,Math.min(S,p.length))),M={};h.forEach(b=>{const d=String(b.label);M[d]=(M[d]||0)+1});let v=null,w=-1;for(const[b,d]of Object.entries(M))d>w&&(v=b,w=d);return v}const U=({dataset:f,onDatasetChange:S,showInstructions:R=!0})=>{const p=x.useRef(null),h=x.useRef(null),[M,v]=x.useState(!0),[w,b]=x.useState(3),d=x.useRef(w),E=x.useRef([]),B=x.useRef("addA"),m=x.useRef(null),y=x.useRef(S),A=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,T=A?"rgba(45,55,72,0.95)":"rgba(255,255,255,0.95)",C=A?"#f7fafc":"#1a202c",W=A?"1px solid rgba(255,255,255,0.1)":"1px solid rgba(0,0,0,0.1)",F=A?"#2d3748":"#ffffff",L=C,X=A?"0 8px 32px rgba(0,0,0,0.6)":"0 8px 32px rgba(0,0,0,0.08)",z=()=>{try{const u=globalThis.process;return!!(u&&u.env&&u.env.NODE_ENV!=="production")}catch{return!1}};return x.useEffect(()=>{const u=e=>{const I=e,Y=6;let g=E.current,j=B.current;e.setup=()=>{p.current&&p.current.querySelectorAll("canvas").forEach(n=>n.remove());const l=p.current?.getBoundingClientRect(),r=Math.max(300,l?.width||600),i=Math.max(300,l?.height||600);if(e.createCanvas(r,i),e.background(240),e.textAlign(e.CENTER,e.CENTER),e.textSize(16),g=E.current=[],f&&Array.isArray(f))for(const n of f){const c=e.map(n.x,-1,1,0,e.width),s=e.map(n.y,-1,1,e.height,0);g.push({coords:[c,s],label:n.label})}N=!0};let N=!0;const k=()=>{N=!0},H=l=>{try{const r=m.current;if(!r||!r.coords){k();return}const i=g.map((t,a)=>({pt:t,i:a})).filter(({pt:t})=>t.label==="A"||t.label==="B"),n=Math.max(1,Math.min(l??d.current,i.length)),c=i.map(({pt:t,i:a})=>({i:a,dist:Math.hypot(t.coords[0]-r.coords[0],t.coords[1]-r.coords[1])}));c.sort((t,a)=>t.dist-a.dist);const s=c.slice(0,n).map(t=>t.i);m.current={...r,neighbors:s},k()}catch(r){k(),z()&&console.debug("knn: recomputeForK error",r)}};try{I.recomputeForK=H,I.requestRedraw=k}catch(l){z()&&console.debug("knn: attach helper error",l)}e.windowResized=()=>{const l=p.current?.getBoundingClientRect(),r=Math.max(300,l?.width||600),i=Math.max(300,l?.height||600);if(e.resizeCanvas(r,i),f&&Array.isArray(f)){g=E.current=[];for(const n of f){const c=e.map(n.x,-1,1,0,e.width),s=e.map(n.y,-1,1,e.height,0);g.push({coords:[c,s],label:n.label})}}k()};const O=()=>{const l=g||[];e.clear(),e.background(240),l.forEach(i=>{const n=i.label==="A"?"red":i.label==="B"?"blue":"green";e.fill(n),e.noStroke(),e.ellipse(i.coords[0],i.coords[1],Y*2)});const r=m.current;if(r&&Array.isArray(r.neighbors)&&r.neighbors.length>0){const i=r.coords;r.neighbors.forEach(n=>{const c=l[n];if(!c)return;e.push();let s;c.label==="A"?s=e.color(255,80,80,160):c.label==="B"?s=e.color(80,140,255,160):s=e.color(80,255,120,160);const t=f&&Array.isArray(f)&&f.length,a=Y*(t?4:6);e.noStroke(),e.fill(s),e.ellipse(c.coords[0],c.coords[1],a),e.stroke(e.red(s),e.green(s),e.blue(s),200),e.strokeWeight(t?2:4),e.noFill(),e.circle(c.coords[0],c.coords[1],a*.9),e.pop(),i&&(e.stroke(60,60,60,160),e.strokeWeight(2),e.line(i[0],i[1],c.coords[0],c.coords[1]))}),r.coords&&(e.push(),e.noStroke(),e.fill(0,200,100,220),e.ellipse(r.coords[0],r.coords[1],Y*4),e.pop())}r&&(e.fill("black"),e.noStroke(),e.textSize(14),e.text(`Predicted: ${r.label}`,e.width/2,e.height-18)),N=!1};e.mousePressed=()=>{if(e.mouseX<0||e.mouseX>e.width||e.mouseY<0||e.mouseY>e.height)return;const l=typeof y.current=="function";if(j==="addA"){if(l){const r=e.map(e.mouseX,0,e.width,-1,1),i=e.map(e.mouseY,e.height,0,-1,1);y.current?.(n=>[...Array.isArray(n)?n:[],{x:r,y:i,label:"A"}]);return}if(g.push({coords:[e.mouseX,e.mouseY],label:"A"}),y.current){const r=e.map(e.mouseX,0,e.width,-1,1),i=e.map(e.mouseY,e.height,0,-1,1);y.current(n=>[...Array.isArray(n)?n:[],{x:r,y:i,label:"A"}])}if(m.current&&m.current.coords){const r=m.current.coords,i=g.map((t,a)=>({pt:t,i:a})).filter(({pt:t})=>t.label==="A"||t.label==="B"),n=P(i.map(({pt:t})=>t),d.current,r),c=i.map(({pt:t,i:a})=>({i:a,dist:Math.hypot(t.coords[0]-r[0],t.coords[1]-r[1])}));c.sort((t,a)=>t.dist-a.dist);const s=c.slice(0,Math.max(1,Math.min(d.current,c.length))).map(t=>t.i);m.current={label:n,neighbors:s,coords:r}}k()}else if(j==="addB"){if(l){const r=e.map(e.mouseX,0,e.width,-1,1),i=e.map(e.mouseY,e.height,0,-1,1);y.current?.(n=>[...Array.isArray(n)?n:[],{x:r,y:i,label:"B"}]);return}if(g.push({coords:[e.mouseX,e.mouseY],label:"B"}),y.current){const r=e.map(e.mouseX,0,e.width,-1,1),i=e.map(e.mouseY,e.height,0,-1,1);y.current(n=>[...Array.isArray(n)?n:[],{x:r,y:i,label:"B"}])}if(m.current&&m.current.coords){const r=m.current.coords,i=g.map((t,a)=>({pt:t,i:a})).filter(({pt:t})=>t.label==="A"||t.label==="B"),n=P(i.map(({pt:t})=>t),d.current,r),c=i.map(({pt:t,i:a})=>({i:a,dist:Math.hypot(t.coords[0]-r[0],t.coords[1]-r[1])}));c.sort((t,a)=>t.dist-a.dist);const s=c.slice(0,Math.max(1,Math.min(d.current,c.length))).map(t=>t.i);m.current={label:n,neighbors:s,coords:r}}k()}else if(j==="predict"){if(g.filter(s=>s.label==="A"||s.label==="B").length<d.current)return;const r=g.map((s,t)=>({pt:s,i:t})).filter(({pt:s})=>s.label==="A"||s.label==="B"),i=P(r.map(({pt:s})=>s),d.current,[e.mouseX,e.mouseY]);if(l){const s=e.map(e.mouseX,0,e.width,-1,1),t=e.map(e.mouseY,e.height,0,-1,1);y.current?.(a=>[...Array.isArray(a)?a:[],{x:s,y:t,label:i}])}else g.push({coords:[e.mouseX,e.mouseY],label:i});const n=r.map(({pt:s,i:t})=>({i:t,dist:Math.hypot(s.coords[0]-e.mouseX,s.coords[1]-e.mouseY)}));n.sort((s,t)=>s.dist-t.dist);const c=n.slice(0,Math.max(1,Math.min(d.current,n.length))).map(s=>s.i);m.current={label:i,neighbors:c,coords:[e.mouseX,e.mouseY]},k()}},e.keyPressed=()=>{e.key==="a"||e.key==="A"?j="addA":e.key==="b"||e.key==="B"?j="addB":(e.key==="p"||e.key==="P")&&(j="predict"),B.current=j,k()},e.draw=()=>{N&&O()},e.resetDemo=()=>{g.length=0,m.current=null;try{y.current&&y.current([])}catch(l){z()&&console.debug("knn: onDatasetChange error",l)}k()}};let K=!0;return v(!0),(async()=>{try{const e=await q();if(!K)return;const I=e&&e.default||e;h.current&&(h.current.remove(),h.current=null),h.current=new I(u,p.current),v(!1)}catch(e){z()&&console.debug("knn: dynamic import p5 failed",e),v(!1)}})(),()=>{K=!1,h.current&&(h.current.remove(),h.current=null)}},[f,R]),x.useEffect(()=>{y.current=S},[S]),x.useEffect(()=>{d.current=w;try{h.current&&typeof h.current.recomputeForK=="function"&&h.current.recomputeForK(w)}catch(u){z()&&console.debug("knn: recompute trigger error",u)}},[w]),o.jsxs("div",{ref:p,style:{position:"relative",width:"calc(100% - 280px)",height:"92%",overflow:"hidden",marginLeft:"-240px",paddingRight:"20px"},children:[M&&o.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.6)",zIndex:2e3},children:o.jsx("div",{style:{padding:12,borderRadius:8,background:"rgba(0,0,0,0.6)",color:"#fff",fontWeight:600},children:"Loading demoâ€¦"})}),o.jsx("div",{style:{position:"absolute",left:12,top:12,zIndex:20},children:o.jsx("button",{id:"knn-clear",onClick:()=>{h.current&&typeof h.current.resetDemo=="function"&&h.current.resetDemo()},style:{padding:"8px 16px",fontSize:12,fontWeight:600,background:T,color:C,border:W,borderRadius:8,cursor:"pointer",backdropFilter:"blur(10px)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",transition:"all 0.2s ease"},onMouseOver:u=>{u.currentTarget.style.transform="translateY(-1px)",u.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)"},onMouseOut:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)"},children:"ðŸ§¹ Clear"})}),R&&o.jsx("div",{style:{position:"absolute",left:12,top:60,zIndex:20,maxWidth:280,background:T,backdropFilter:"blur(10px)",borderRadius:10,padding:"10px 12px",border:W,boxShadow:X},children:o.jsxs("div",{style:{fontSize:12,color:C,lineHeight:1.5},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:4,fontSize:11,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"ðŸ” K-Nearest Neighbors"}),o.jsxs("div",{style:{fontSize:11,opacity:.9},children:[o.jsx("span",{style:{fontWeight:600},children:"Click:"})," Add points",o.jsx("br",{}),o.jsx("span",{style:{fontWeight:600},children:"A key:"})," Red (Class A)",o.jsx("br",{}),o.jsx("span",{style:{fontWeight:600},children:"B key:"})," Blue (Class B)",o.jsx("br",{}),o.jsx("span",{style:{fontWeight:600},children:"P key:"})," Predict (Green)"]})]})}),o.jsxs("div",{style:{position:"fixed",right:16,top:86,zIndex:1150,padding:"14px",background:T,borderRadius:"12px",width:240,boxSizing:"border-box",color:C,border:W,boxShadow:X},children:[o.jsx("div",{style:{marginBottom:12,paddingBottom:10,borderBottom:`1px solid ${A?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,fontSize:13,fontWeight:600,letterSpacing:"0.3px"},children:"âš™ï¸ Model Controls"}),o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:6,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Parameters"}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:11,color:C,opacity:.8,display:"block",marginBottom:4},children:"K (Neighbors)"}),o.jsx("input",{type:"number",value:w,min:1,max:20,onChange:u=>b(Math.max(1,Math.min(20,parseInt(u.target.value)||1))),onInput:u=>b(Math.max(1,Math.min(20,parseInt(u.target.value)||1))),style:{width:"100%",padding:"6px 8px",fontSize:13,background:F,color:L,borderRadius:6,border:W,boxSizing:"border-box"}})]})]}),o.jsxs("div",{style:{marginTop:12,padding:"8px",background:A?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",borderRadius:6,fontSize:11,lineHeight:1.5},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:4,opacity:.7},children:"Current Mode:"}),o.jsx("div",{style:{fontSize:12,fontWeight:600,color:B.current==="addA"?"#e53e3e":B.current==="addB"?"#3182ce":"#38a169"},children:B.current==="addA"?"ðŸ”´ Add Class A (Red)":B.current==="addB"?"ðŸ”µ Add Class B (Blue)":"ðŸŸ¢ Predict Class"})]}),o.jsxs("div",{style:{marginTop:14,paddingTop:12,borderTop:`1px solid ${A?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`},children:[o.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:8,opacity:.7,textTransform:"uppercase",letterSpacing:"0.5px"},children:"ðŸ“– Instructions"}),o.jsxs("div",{style:{fontSize:11,lineHeight:1.6,opacity:.9},children:[o.jsxs("div",{style:{marginBottom:6},children:[o.jsx("span",{style:{fontWeight:600},children:"Click canvas:"})," Add points"]}),o.jsxs("div",{style:{marginBottom:6},children:[o.jsx("span",{style:{fontWeight:600},children:"A key:"})," Switch to Class A (Red)"]}),o.jsxs("div",{style:{marginBottom:6},children:[o.jsx("span",{style:{fontWeight:600},children:"B key:"})," Switch to Class B (Blue)"]}),o.jsxs("div",{style:{marginBottom:6},children:[o.jsx("span",{style:{fontWeight:600},children:"P key:"})," Predict mode (Green)"]}),o.jsx("div",{style:{marginTop:8,fontSize:10,opacity:.75,fontStyle:"italic"},children:"KNN classifies points based on the K nearest neighbors' votes."})]})]})]})]})};export{U as default};
